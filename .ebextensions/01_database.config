files:
  "/opt/elasticbeanstalk/hooks/appdeploy/post/99_setup_database.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      # Setup persistent database location

      PERSISTENT_DB="/var/app-data/betting_data.db"
      SOURCE_DB="/var/app/current/ui/data_storage/betting_data.db"

      # Create directory if it doesn't exist
      mkdir -p /var/app-data

      # If persistent DB doesn't exist, copy from source
      if [ ! -f "$PERSISTENT_DB" ]; then
        echo "Initializing persistent database..."
        if [ -f "$SOURCE_DB" ]; then
          cp "$SOURCE_DB" "$PERSISTENT_DB"
          echo "Database copied to persistent location"
        else
          echo "Source database not found, will be created by application"
        fi
      else
        echo "Persistent database already exists, preserving data"
      fi

      # Set permissions
      chown webapp:webapp "$PERSISTENT_DB" 2>/dev/null || true
      chmod 664 "$PERSISTENT_DB" 2>/dev/null || true

